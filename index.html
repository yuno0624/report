<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è–å¾³å¤§ãƒ¬ãƒãƒ¼ãƒˆè·äººã‚»ãƒƒãƒˆ</title>
  <style>
    body {
      font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
      padding: 1.5rem;
      background: #fefefe;
      color: #333;
      line-height: 1.6;
      max-width: 720px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 140px;
      font-size: 1rem;
      margin-top: 0.5rem;
      padding: 0.75rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 0.2rem;
    }
    .section {
      margin-bottom: 2rem;
    }
    .count {
      font-weight: bold;
      color: green;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    #totalError {
      color: crimson;
      font-weight: bold;
      font-size: 1.1rem;
      margin-top: 1rem;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      background: #0074cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    details {
      background: #f0f8ff;
      padding: 1rem;
      margin-bottom: 2rem;
      border-left: 4px solid #0074cc;
    }
    summary {
      font-weight: bold;
      cursor: pointer;
      font-size: 1.1rem;
    }
    .checklist {
      background: #f7f7f7;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 2rem;
    }
    .checklist label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      textarea {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <h1>è–å¾³å¤§å­¦ é€šä¿¡æ•™è‚²éƒ¨ ãƒ¬ãƒãƒ¼ãƒˆã²ãªå‹</h1>

  <details open>
    <summary>ğŸ“˜ ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼‰</summary>
    <ul>
      <li>å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å…¥åŠ› â†’ æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°</li>
      <li>å…¥åŠ›å†…å®¹ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ï¼ˆè‡ªå‹•ï¼‰â†’ ã‚¹ãƒãƒ›ã§ã‚‚å®‰å¿ƒ</li>
      <li>ã€Œãƒ¬ãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯ã€ãƒœã‚¿ãƒ³ã§åŠ©è©ã‚„æ–‡å­—æ•°ã®ã–ã£ãã‚Šæ¤œæŸ»</li>
      <li>ç·æ–‡å­—æ•°ã¯ <strong>1500ã€œ1600å­—</strong> ãŒç›®å®‰</li>
      <li>å‚è€ƒæ–‡çŒ®æ¬„ã®æ–‡å­—æ•°ã¯ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã›ã‚“</li>
      <li>æœ€å¾Œã«ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§æå‡ºæ¡ä»¶ã‚’ç¢ºèªï¼</li>
    </ul>
  </details>

  <div class="section">
    <label for="intro">åºè«–ï¼ˆç›®å®‰ï¼š~320å­—ï¼‰</label>
    <textarea id="intro" placeholder="ãƒ†ãƒ¼ãƒã®èƒŒæ™¯ã€ç›®çš„ã€è«–ç‚¹ãªã©"></textarea>
    <p>æ–‡å­—æ•°ï¼š<span id="introCount" class="count">0</span> å­—</p>
    <p id="introError" class="error"></p>
  </div>

  <div class="section">
    <label for="body">æœ¬è«–ï¼ˆç›®å®‰ï¼š~960å­—ï¼‰</label>
    <textarea id="body" placeholder="ãƒ‡ãƒ¼ã‚¿ãƒ»è³‡æ–™ã«åŸºã¥ã„ãŸè­°è«–"></textarea>
    <p>æ–‡å­—æ•°ï¼š<span id="bodyCount" class="count">0</span> å­—</p>
    <p id="bodyError" class="error"></p>
  </div>

  <div class="section">
    <label for="conclusion">çµè«–ï¼ˆç›®å®‰ï¼š~320å­—ï¼‰</label>
    <textarea id="conclusion" placeholder="è¦ç´„ã€å•ã„ã¸ã®ç­”ãˆã€ä»Šå¾Œã®å±•æœ›ãªã©"></textarea>
    <p>æ–‡å­—æ•°ï¼š<span id="conclusionCount" class="count">0</span> å­—</p>
    <p id="conclusionError" class="error"></p>
  </div>

  <div class="section">
    <label for="references">å‚è€ƒæ–‡çŒ®ï¼ˆæ–‡å­—æ•°ã«ã¯å«ã¾ã‚Œã¾ã›ã‚“ï¼‰</label>
    <textarea id="references" placeholder="ã€ˆè‘—è€…ã€‰ æ›¸åã€å‡ºç‰ˆç¤¾ã€å‡ºç‰ˆå¹´ã€ãƒšãƒ¼ã‚¸ or URLãƒ»é–²è¦§æ—¥ãªã©"></textarea>
  </div>

  <button onclick="validate()">ãƒ¬ãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯</button>

  <div id="total">
    <p><strong>ç·æ–‡å­—æ•°ï¼š</strong><span id="totalCount">0</span> å­—</p>
    <p id="totalError"></p>
  </div>

  <div class="checklist">
    <h2>âœ… æå‡ºç›´å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h2>
    <label><input type="checkbox" id="chk1" /> è¡¨ç´™ã‚’è²¼ã£ãŸ</label>
    <label><input type="checkbox" id="chk2" /> B5ç‰‡é¢ã§å°åˆ·ã—ãŸ</label>
    <label><input type="checkbox" id="chk3" /> ç·æ–‡å­—æ•°1500ã€œ1600å­—ã‚’æº€ãŸã—ã¦ã„ã‚‹</label>
    <label><input type="checkbox" id="chk4" /> å¼•ç”¨ã¯ã€ˆã€‰ã§æ‹¬ã‚Šã€å‡ºå…¸ã‚’æ˜è¨˜ã—ãŸ</label>
    <label><input type="checkbox" id="chk5" /> å‚è€ƒæ–‡çŒ®æ¬„ã«å…¨ã¦ã®è³‡æ–™ã‚’è¨˜è¼‰ã—ãŸ</label>
    <label><input type="checkbox" id="chk6" /> è³ªå•ãƒ»è¦æœ›ãªã©ä½™è¨ˆãªå†…å®¹ã‚’æ›¸ã„ã¦ã„ãªã„</label>
  </div>

  <script>
    const sections = ['intro', 'body', 'conclusion']
    const particleErrors = ['ã‚’ã¯', 'ã«ã¯ã¯', 'ã«ã‚’', 'ã§ãŒ', 'ãŒã¨', 'ã¨ã¯']
    const minTotal = 1500
    const maxTotal = 1600
    const checklistIds = ['chk1', 'chk2', 'chk3', 'chk4', 'chk5', 'chk6']

    const countChars = text => text.replace(/\s/g, '').length
    const checkParticles = text => particleErrors.find(p => text.includes(p)) || ''

    const saveDraft = () => {
      sections.forEach(id => localStorage.setItem(id, document.getElementById(id).value))
      localStorage.setItem('references', document.getElementById('references').value)
      checklistIds.forEach(id => {
        localStorage.setItem(id, document.getElementById(id).checked)
      })
    }

    const loadDraft = () => {
      sections.forEach(id => {
        const val = localStorage.getItem(id)
        if (val) document.getElementById(id).value = val
      })
      const ref = localStorage.getItem('references')
      if (ref) document.getElementById('references').value = ref
      checklistIds.forEach(id => {
        const state = localStorage.getItem(id)
        if (state !== null) document.getElementById(id).checked = state === 'true'
      })
    }

    const validate = () => update(true)

    const update = (showErrors = false) => {
      let total = 0
      sections.forEach(id => {
        const text = document.getElementById(id).value
        const count = countChars(text)
        total += count
        document.getElementById(id + 'Count').textContent = count

        let errorMsg = ''
        if (showErrors) {
          if (!text.trim()) errorMsg = 'âš  ç©ºæ¬„ã§ã™'
          else {
            const particle = checkParticles(text)
            if (particle) errorMsg = `âš  åŠ©è©ã€Œ${particle}ã€ã®ä½¿ã„æ–¹ãŒä¸è‡ªç„¶ã‹ã‚‚`
            else if (!/[ã¯ã‚’ãŒ]/.test(text)) errorMsg = 'âš  ã€Œã¯ã€ã€Œã‚’ã€ã€ŒãŒã€ãªã©ãŒå°‘ãªã„ã‹ã‚‚'
          }
        }
        document.getElementById(id + 'Error').textContent = errorMsg
      })

      document.getElementById('totalCount').textContent = total
      const err = document.getElementById('totalError')
      if (showErrors) {
        if (total < minTotal || total > maxTotal) {
          err.textContent = `âš  ç·æ–‡å­—æ•°ãŒåŸºæº–å¤–ã§ã™ï¼ˆç¾åœ¨ ${total} å­—ï¼å¿…è¦ 1500ã€œ1600 å­—ï¼‰`
        } else {
          err.textContent = 'âœ… ç·æ–‡å­—æ•°ã¯åŸºæº–å†…ã§ã™'
        }
      } else {
        err.textContent = ''
      }

      saveDraft()
    }

    sections.concat(['references']).forEach(id =>
      document.getElementById(id).addEventListener('input', () => update(false))
    )

    checklistIds.forEach(id => {
      document.getElementById(id).addEventListener('change', saveDraft)
    })

    loadDraft()
    update()
  </script>
</body>
</html>
